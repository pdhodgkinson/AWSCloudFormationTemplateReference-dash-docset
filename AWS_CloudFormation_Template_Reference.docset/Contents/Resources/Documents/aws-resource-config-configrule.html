<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <h1 class="topictitle" id="aws-resource-config-configrule">AWS::Config::ConfigRule</h1><p>The <code class="code">AWS::Config::ConfigRule</code> resource uses an AWS Lambda (Lambda) function that
                        evaluates configuration items to assess whether your AWS resources comply with your
                        specified
                        configurations. This function can run when AWS Config detects a configuration change
                        or delivers a
                        configuration snapshot. The resources this function evaluates must be in the recording
                        group.
                        For more information, see <a href="http://docs.aws.amazon.com/config/latest/developerguide/evaluate-config.html" target="_blank">Evaluating AWS Resource
                           Configurations with AWS Config</a> in the <em>AWS Config Developer Guide</em>.
                     </p><div class="highlights">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#aws-resource-config-configrule-syntax">Syntax</a></li>
                           <li><a href="#w2ab2c21c10d263b9">Properties</a></li>
                           <li><a href="#w2ab2c21c10d263c11">Return Values</a></li>
                           <li><a href="#w2ab2c21c10d263c13">Examples</a></li>
                        </ul>
                     </div><h2 id="aws-resource-config-configrule-syntax">Syntax</h2><p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p><div id="JSON" name="JSON" class="section langfilter">
                        <h3 id="aws-resource-config-configrule-syntax.json">JSON</h3>
                        
                        <pre class="programlisting"><div class="btn-copy-code-container"><div class="btn btn-copy-code">Copy</div></div><code class="nohighlight">{
  &quot;Type&quot; : &quot;AWS::Config::ConfigRule&quot;,
  &quot;Properties&quot; : {
    &quot;<a href="aws-resource-config-configrule.html#cfn-config-configrule-configrulename"><code class="code">ConfigRuleName</code></a>&quot; : <em class="replaceable"><code>String</code></em>,
    &quot;<a href="aws-resource-config-configrule.html#cfn-config-configrule-description"><code class="code">Description</code></a>&quot; : <em class="replaceable"><code>String</code></em>,
    &quot;<a href="aws-resource-config-configrule.html#cfn-config-configrule-inputparameters"><code class="code">InputParameters</code></a>&quot; : { <em class="replaceable"><code>ParameterName</code></em> : <em class="replaceable"><code>Value</code></em> },
    &quot;<a href="aws-resource-config-configrule.html#cfn-config-configrule-maximumexecutionfrequency"><code class="code">MaximumExecutionFrequency</code></a>&quot; : <em class="replaceable"><code>String</code></em>,
    &quot;<a href="aws-resource-config-configrule.html#cfn-config-configrule-scope"><code class="code">Scope</code></a>&quot; : <em class="replaceable"><code>Scope</code></em>,
    &quot;<a href="aws-resource-config-configrule.html#cfn-config-configrule-source"><code class="code">Source</code></a>&quot; : <em class="replaceable"><code>Source</code></em>
  }
}</code></pre>
                        </div><div id="YAML" name="YAML" class="section langfilter">
                        <h3 id="aws-resource-config-configrule-syntax.yaml">YAML</h3>
                        
                        <pre class="programlisting"><div class="btn-copy-code-container"><div class="btn btn-copy-code">Copy</div></div><code class="nohighlight">Type: &quot;AWS::Config::ConfigRule&quot;
Properties:
  <a href="aws-resource-config-configrule.html#cfn-config-configrule-configrulename"><code class="code">ConfigRuleName</code></a>: <em class="replaceable"><code>String</code></em>
  <a href="aws-resource-config-configrule.html#cfn-config-configrule-description"><code class="code">Description</code></a>: <em class="replaceable"><code>String</code></em>
  <a href="aws-resource-config-configrule.html#cfn-config-configrule-inputparameters"><code class="code">InputParameters</code></a>:
    <em class="replaceable"><code>ParameterName</code></em> : <em class="replaceable"><code>Value</code></em>
  <a href="aws-resource-config-configrule.html#cfn-config-configrule-maximumexecutionfrequency"><code class="code">MaximumExecutionFrequency</code></a>: <em class="replaceable"><code>String</code></em>
  <a href="aws-resource-config-configrule.html#cfn-config-configrule-scope"><code class="code">Scope</code></a>:
    <em class="replaceable"><code>Scope</code></em>
  <a href="aws-resource-config-configrule.html#cfn-config-configrule-source"><code class="code">Source</code></a>:
    <em class="replaceable"><code>Source</code></em>
</code></pre>
                        </div><h2 id="w2ab2c21c10d263b9">Properties</h2><div class="variablelist">
                        
                        
                        
                        
                        
                        
                        
                        <dl>
                           
                           <dt><a id="cfn-config-configrule-configrulename"></a><span class="term"><code class="code">ConfigRuleName</code></span></dt>
                           
                           <dd>
                              
                              <p>A name for the AWS Config rule. If you don&apos;t specify a name, AWS CloudFormation generates
                                 a unique
                                 physical ID and uses that ID for the rule name. For more information, see <a href="aws-properties-name.html">Name Type</a>.
                              </p>
                              
                              <p><em>Required: </em>No
                              </p>
                              
                              <p><em>Type</em>: String
                              </p>
                              
                              <p><em>Update requires</em>: <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                              
                           </dd>
                           
                           
                           <dt><a id="cfn-config-configrule-description"></a><span class="term"><code class="code">Description</code></span></dt>
                           
                           <dd>
                              
                              <p>A description about this AWS Config rule.</p>
                              
                              <p><em>Required: </em>No
                              </p>
                              
                              <p><em>Type</em>: String
                              </p>
                              
                              <p><em>Update requires</em>: <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                              
                           </dd>
                           
                           
                           <dt><a id="cfn-config-configrule-inputparameters"></a><span class="term"><code class="code">InputParameters</code></span></dt>
                           
                           <dd>
                              
                              <p>Input parameter values that are passed to the AWS Config rule (Lambda function).</p>
                              
                              <p><em>Required: </em>No
                              </p>
                              
                              <p><em>Type</em>: JSON object
                              </p>
                              
                              <p><em>Update requires</em>: <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                              
                           </dd>
                           
                           
                           <dt><a id="cfn-config-configrule-maximumexecutionfrequency"></a><span class="term"><code class="code">MaximumExecutionFrequency</code></span></dt>
                           
                           <dd>
                              
                              <p>The maximum frequency at which the AWS Config rule runs evaluations. For valid values,
                                 see
                                 the <a href="http://docs.aws.amazon.com/config/latest/APIReference/API_ConfigRule.html" target="_blank">ConfigRule</a> data type in the
                                 <em>AWS Config API Reference</em>.
                              </p>
                              
                              <p>If the rule runs an evaluation when AWS Config delivers a configuration snapshot,
                                 the rule
                                 cannot run more frequently than the snapshot delivery frequency. Set an execution
                                 frequency value that is equal to or greater than the value of the snapshot delivery
                                 frequency, which is a property the <a href="aws-resource-config-deliverychannel.html">AWS::Config::DeliveryChannel</a> resource.
                              </p>
                              
                              <p><em>Required: </em>No
                              </p>
                              
                              <p><em>Type</em>: String
                              </p>
                              
                              <p><em>Update requires</em>: <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                              
                           </dd>
                           
                           
                           <dt><a id="cfn-config-configrule-scope"></a><span class="term"><code class="code">Scope</code></span></dt>
                           
                           <dd>
                              
                              <p>Defines which AWS resources will trigger an evaluation when their configurations
                                 change. The scope can include one or more resource types, a combination of a tag key
                                 and
                                 value, or a combination of one resource type and one resource ID. Specify a scope
                                 to
                                 constrain the resources that are evaluated. If you don&apos;t specify a scope, the rule
                                 evaluates all resources in the recording group.
                              </p>
                              
                              <p><em>Required: </em>No
                              </p>
                              
                              <p><em>Type</em>: <a href="aws-properties-config-configrule-scope.html">AWS Config ConfigRule Scope</a></p>
                              
                              <p><em>Update requires</em>: <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                              
                           </dd>
                           
                           
                           <dt><a id="cfn-config-configrule-source"></a><span class="term"><code class="code">Source</code></span></dt>
                           
                           <dd>
                              
                              <p>Specifies the rule owner, the rule identifier, and the events that cause the
                                 function to evaluate your AWS resources.
                              </p>
                              
                              <p><em>Required: </em>Yes
                              </p>
                              
                              <p><em>Type</em>: <a href="aws-properties-config-configrule-source.html">AWS Config ConfigRule Source</a></p>
                              
                              <p><em>Update requires</em>: <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                              
                           </dd>
                           
                        </dl>
                     </div><h2 id="w2ab2c21c10d263c11">Return Values</h2><h3 id="w2ab2c21c10d263c11b2">Ref</h3><p>When you pass the logical ID of an <code class="code">AWS::Config::ConfigRule</code> resource to the
                        intrinsic <code class="code">Ref</code> function, the function returns the rule name, such as
                        <code class="code">mystack-MyConfigRule-12ABCFPXHV4OV</code>.
                     </p><p>For more information about using the <code class="code">Ref</code> function, see <a href="intrinsic-function-reference-ref.html">Ref</a>.
                     </p><h3 id="w2ab2c21c10d263c11b4">Fn::GetAtt</h3><p><code class="code">Fn::GetAtt</code> returns a value for a specified attribute of this type.
                        The following are the available attributes and sample return values.
                     </p><div class="variablelist">
                        
                        
                        
                        
                        <dl>
                           
                           <dt><span class="term"><code class="code">Arn</code></span></dt>
                           
                           <dd>
                              
                              <p>The Amazon Resource Name (ARN) of the AWS Config rule, such as
                                 <code class="code">arn:aws:config:us-east-1:123456789012:config-rule/config-rule-a1bzhi</code>.
                              </p>
                              
                           </dd>
                           
                           
                           <dt><span class="term"><code class="code">ConfigRuleId</code></span></dt>
                           
                           <dd>
                              
                              <p>The ID of the AWS Config rule, such as <code class="code">config-rule-a1bzhi</code>.
                              </p>
                              
                           </dd>
                           
                           
                           <dt><span class="term"><code class="code">Compliance.Type</code></span></dt>
                           
                           <dd>
                              
                              <p>The compliance status of  an AWS Config rule, such as <code class="code">COMPLIANT</code> or
                                 <code class="code">NON_COMPLIANT</code>.
                              </p>
                              
                           </dd>
                           
                        </dl>
                     </div><p>For more information about using <code class="code">Fn::GetAtt</code>, see <a href="intrinsic-function-reference-getatt.html">Fn::GetAtt</a>.
                     </p><h2 id="w2ab2c21c10d263c13">Examples</h2><h3 id="w2ab2c21c10d263c13b2"></h3><p>The following example uses an AWS managed rule that checks whether EC2 volumes resource
                        types have a <code class="code">CostCenter</code> tag.
                     </p><div id="JSON" name="JSON" class="section langfilter">
                        <h4 id="aws-resource-config-configrule-example1.json">JSON</h4>
                        
                        <pre class="programlisting"><div class="btn-copy-code-container"><div class="btn btn-copy-code">Copy</div></div><code class="nohighlight ">&quot;ConfigRuleForVolumeTags&quot;: {
  &quot;Type&quot;: &quot;AWS::Config::ConfigRule&quot;,
  &quot;Properties&quot;: {
    &quot;InputParameters&quot;: {&quot;tag1Key&quot;: &quot;CostCenter&quot;},
    &quot;Scope&quot;: {
      &quot;ComplianceResourceTypes&quot;: [&quot;AWS::EC2::Volume&quot;]
    },
    &quot;Source&quot;: {
      &quot;Owner&quot;: &quot;AWS&quot;,
      &quot;SourceIdentifier&quot;: &quot;REQUIRED_TAGS&quot;
    }
  }
}</code></pre>
                        </div><div id="YAML" name="YAML" class="section langfilter">
                        <h4 id="aws-resource-config-configrule-example1.yaml">YAML</h4>
                        
                        <pre class="programlisting"><div class="btn-copy-code-container"><div class="btn btn-copy-code">Copy</div></div><code class="nohighlight ">ConfigRuleForVolumeTags: 
  Type: &quot;AWS::Config::ConfigRule&quot;
  Properties: 
    InputParameters: 
      tag1Key: CostCenter
    Scope: 
      ComplianceResourceTypes: 
        - &quot;AWS::EC2::Volume&quot;
    Source: 
      Owner: AWS
      SourceIdentifier: &quot;REQUIRED_TAGS&quot;</code></pre>
                        </div><h3 id="w2ab2c21c10d263c13b4">Rule Using Lambda Function</h3><p>The following example creates a custom configuration rule that uses a Lambda function.
                        The
                        function checks whether an EC2 volume has the <code class="code">AutoEnableIO</code> property set to true.
                        Note that the configuration rule has a dependency on the Lambda policy so that the
                        rule calls
                        the function only after it&apos;s permitted to do so.
                     </p><div id="JSON" name="JSON" class="section langfilter">
                        <h4 id="aws-resource-config-configrule-example2.json">JSON</h4>
                        
                        <pre class="programlisting"><div class="btn-copy-code-container"><div class="btn btn-copy-code">Copy</div></div><code class="nohighlight ">&quot;ConfigPermissionToCallLambda&quot;: {
  &quot;Type&quot;: &quot;AWS::Lambda::Permission&quot;,
  &quot;Properties&quot;: {
    &quot;FunctionName&quot;: {&quot;Fn::GetAtt&quot;: [&quot;VolumeAutoEnableIOComplianceCheck&quot;, &quot;Arn&quot;]},
    &quot;Action&quot;: &quot;lambda:InvokeFunction&quot;,
    &quot;Principal&quot;: &quot;config.amazonaws.com&quot;
  }
},
&quot;VolumeAutoEnableIOComplianceCheck&quot;: {
  &quot;Type&quot;: &quot;AWS::Lambda::Function&quot;,
  &quot;Properties&quot;: {
    &quot;Code&quot;: {
      &quot;ZipFile&quot;:  {&quot;Fn::Join&quot;: [&quot;\n&quot;, [
        &quot;var aws  = require(&apos;aws-sdk&apos;);&quot;,
        &quot;var config = new aws.ConfigService();&quot;,
        &quot;var ec2 = new aws.EC2();&quot;,

        &quot;exports.handler = function(event, context) {&quot;,
        &quot;    compliance = evaluateCompliance(event, function(compliance, event) {&quot;,
        &quot;        var configurationItem = JSON.parse(event.invokingEvent).configurationItem;&quot;,

        &quot;        var putEvaluationsRequest = {&quot;,
        &quot;            Evaluations: [{&quot;,
        &quot;                ComplianceResourceType: configurationItem.resourceType,&quot;,
        &quot;                ComplianceResourceId: configurationItem.resourceId,&quot;,
        &quot;                ComplianceType: compliance,&quot;,
        &quot;                OrderingTimestamp: configurationItem.configurationItemCaptureTime&quot;,
        &quot;            }],&quot;,
        &quot;            ResultToken: event.resultToken&quot;,
        &quot;        };&quot;,

        &quot;        config.putEvaluations(putEvaluationsRequest, function(err, data) {&quot;,
        &quot;            if (err) context.fail(err);&quot;,
        &quot;            else context.succeed(data);&quot;,
        &quot;        });&quot;,
        &quot;    });&quot;,
        &quot;};&quot;,

        &quot;function evaluateCompliance(event, doReturn) {&quot;,
        &quot;    var configurationItem = JSON.parse(event.invokingEvent).configurationItem;&quot;,
        &quot;    var status = configurationItem.configurationItemStatus;&quot;,
        &quot;    if (configurationItem.resourceType !== &apos;AWS::EC2::Volume&apos; || event.eventLeftScope || (status !== &apos;OK&apos; &amp;&amp; status !== &apos;ResourceDiscovered&apos;))&quot;,
        &quot;        doReturn(&apos;NOT_APPLICABLE&apos;, event);&quot;,
        &quot;    else ec2.describeVolumeAttribute({VolumeId: configurationItem.resourceId, Attribute: &apos;autoEnableIO&apos;}, function(err, data) {&quot;,
        &quot;        if (err) context.fail(err);&quot;,
        &quot;        else if (data.AutoEnableIO.Value) doReturn(&apos;COMPLIANT&apos;, event);&quot;,
        &quot;        else doReturn(&apos;NON_COMPLIANT&apos;, event);&quot;,
        &quot;    });&quot;,
        &quot;}&quot;
      ]]}
    },
    &quot;Handler&quot;: &quot;index.handler&quot;,
    &quot;Runtime&quot;: &quot;nodejs4.3&quot;,
    &quot;Timeout&quot;: &quot;30&quot;,
    &quot;Role&quot;: {&quot;Fn::GetAtt&quot;: [&quot;LambdaExecutionRole&quot;, &quot;Arn&quot;]}
  }
},
&quot;ConfigRuleForVolumeAutoEnableIO&quot;: {
  &quot;Type&quot;: &quot;AWS::Config::ConfigRule&quot;,
  &quot;Properties&quot;: {
    &quot;ConfigRuleName&quot;: &quot;ConfigRuleForVolumeAutoEnableIO&quot;,
    &quot;Scope&quot;: {
      &quot;ComplianceResourceId&quot;: {&quot;Ref&quot;: &quot;Ec2Volume&quot;},
      &quot;ComplianceResourceTypes&quot;: [&quot;AWS::EC2::Volume&quot;]
    },
    &quot;Source&quot;: {
      &quot;Owner&quot;: &quot;CUSTOM_LAMBDA&quot;,
      &quot;SourceDetails&quot;: [{
          &quot;EventSource&quot;: &quot;aws.config&quot;,
          &quot;MessageType&quot;: &quot;ConfigurationItemChangeNotification&quot;
      }],
      &quot;SourceIdentifier&quot;: {&quot;Fn::GetAtt&quot;: [&quot;VolumeAutoEnableIOComplianceCheck&quot;, &quot;Arn&quot;]}
    }
  },
  &quot;DependsOn&quot;: &quot;ConfigPermissionToCallLambda&quot;
}</code></pre>
                        </div><div id="YAML" name="YAML" class="section langfilter">
                        <h4 id="aws-resource-config-configrule-example2.yaml">YAML</h4>
                        
                        <pre class="programlisting"><div class="btn-copy-code-container"><div class="btn btn-copy-code">Copy</div></div><code class="nohighlight ">ConfigPermissionToCallLambda: 
  Type: &quot;AWS::Lambda::Permission&quot;
  Properties: 
    FunctionName: 
      Fn::GetAtt: 
        - VolumeAutoEnableIOComplianceCheck
        - Arn
    Action: &quot;lambda:InvokeFunction&quot;
    Principal: &quot;config.amazonaws.com&quot;
VolumeAutoEnableIOComplianceCheck: 
  Type: &quot;AWS::Lambda::Function&quot;
  Properties: 
    Code: 
      ZipFile: 
        !Sub |
          var aws  = require(&apos;aws-sdk&apos;);
          var config = new aws.ConfigService();
          var ec2 = new aws.EC2();
          exports.handler = function(event, context) {
              compliance = evaluateCompliance(event, function(compliance, event) {
                    var configurationItem = JSON.parse(event.invokingEvent).configurationItem;
                    var putEvaluationsRequest = {
                        Evaluations: [{
                            ComplianceResourceType: configurationItem.resourceType,
                            ComplianceResourceId: configurationItem.resourceId,
                            ComplianceType: compliance,
                            OrderingTimestamp: configurationItem.configurationItemCaptureTime
                        }],
                        ResultToken: event.resultToken
                    };
                    config.putEvaluations(putEvaluationsRequest, function(err, data) {
                        if (err) context.fail(err);
                        else context.succeed(data);
                    });
                });
            };
            function evaluateCompliance(event, doReturn) {
                var configurationItem = JSON.parse(event.invokingEvent).configurationItem;
                var status = configurationItem.configurationItemStatus;
                if (configurationItem.resourceType !== &apos;AWS::EC2::Volume&apos; || event.eventLeftScope || (status !== &apos;OK&apos; &amp;&amp; status !== &apos;ResourceDiscovered&apos;))
                    doReturn(&apos;NOT_APPLICABLE&apos;, event);
                else ec2.describeVolumeAttribute({VolumeId: configurationItem.resourceId, Attribute: &apos;autoEnableIO&apos;}, function(err, data) {
                    if (err) context.fail(err);
                    else if (data.AutoEnableIO.Value) doReturn(&apos;COMPLIANT&apos;, event);
                    else doReturn(&apos;NON_COMPLIANT&apos;, event);
                });
            }
    Handler: &quot;index.handler&quot;
    Runtime: nodejs4.3
    Timeout: 30
    Role: 
      Fn::GetAtt: 
        - LambdaExecutionRole
        - Arn
ConfigRuleForVolumeAutoEnableIO: 
  Type: &quot;AWS::Config::ConfigRule&quot;
  Properties: 
    ConfigRuleName: ConfigRuleForVolumeAutoEnableIO
    Scope: 
      ComplianceResourceId: 
        Ref: Ec2Volume
      ComplianceResourceTypes: 
        - &quot;AWS::EC2::Volume&quot;
    Source: 
      Owner: &quot;CUSTOM_LAMBDA&quot;
      SourceDetails: 
        - 
          EventSource: &quot;aws.config&quot;
          MessageType: &quot;ConfigurationItemChangeNotification&quot;
      SourceIdentifier: 
        Fn::GetAtt: 
          - VolumeAutoEnableIOComplianceCheck
          - Arn
  DependsOn: ConfigPermissionToCallLambda</code></pre>
                        </div></div>
</body>
</html>